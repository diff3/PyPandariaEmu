"""SMSG_ADDON_INFO"""

import struct

# Binärdata från loggen
data = b'\x00\x00\x00\x00\x16$\x92I$\x92I$\x92I$\x92I$\x92I$\x90\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02\x01\x00\x00\x00\x00\x02'

# Läser antal förbjudna tillägg och tilläggslista
banned_addons_count = int.from_bytes(data[0:3], "big") >> 5
addons_list_count = int.from_bytes(data[2:5], "big") & 0x7FFFFF

print(f"Banned Addons: {banned_addons_count}")
print(f"Addons List Count: {addons_list_count}")

offset = 5
addons = []

# Parsar tilläggslistan
for _ in range(addons_list_count):
    has_url = (data[offset] & 0b100) >> 2
    enabled = (data[offset] & 0b010) >> 1
    has_public_key = data[offset] & 0b001
    offset += 1

    addon = {"Has URL": has_url, "Enabled": enabled, "Has Public Key": has_public_key}
    if has_public_key:
        offset += 256  # Hoppa över den publika nyckeln
    if enabled:
        addon["Enabled"] = struct.unpack_from("B", data, offset)[0]
        offset += 1
        addon["Unknown"] = struct.unpack_from("I", data, offset)[0]
        offset += 4
    addon["State"] = struct.unpack_from("B", data, offset)[0]
    offset += 1

    addons.append(addon)

print("Addons:", addons)

# Parsar förbjudna tillägg
banned_addons = []
for _ in range(banned_addons_count):
    addon_id = struct.unpack_from("I", data, offset)[0]
    is_banned = struct.unpack_from("I", data, offset + 4)[0]
    timestamp = struct.unpack_from("I", data, offset + 40)[0]
    banned_addons.append({"ID": addon_id, "IsBanned": is_banned, "Timestamp": timestamp})
    offset += 44

print("Banned Addons:", banned_addons)
